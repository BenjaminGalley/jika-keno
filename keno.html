<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simba Keno Pro</title>
    <style>
        :root { --gold: #fbbf24; --bg: #0b0d17; --win: #22c55e; --loss: #ef4444; --card: #1a1d29; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; padding: 10px; text-align: center; }
        
        #historySide { position: fixed; right: -210px; top: 0; width: 200px; height: 100%; background: #000; border-left: 2px solid var(--gold); transition: 0.3s; z-index: 100; padding: 10px; overflow-y: auto; text-align: left; }
        #historySide.open { right: 0; }
        
        .selection-strip { background: #000; color: var(--gold); padding: 12px; min-height: 25px; margin: 10px 0; border-radius: 8px; font-weight: bold; border: 1px dashed #444; font-size: 18px; }
        .grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 4px; max-width: 450px; margin: auto; }
        .num { background: #1e293b; aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 4px; font-size: 14px; cursor: pointer; border: 1px solid #000; }
        .num.selected { background: var(--gold); color: black; font-weight: bold; }
        .num.draw-glow { box-shadow: inset 0 0 15px var(--win), 0 0 10px var(--win); border: 2px solid white; z-index: 5; }

        .ticket-stack { margin: 15px auto; max-width: 400px; display: flex; flex-direction: column-reverse; gap: 6px; }
        .ticket { background: var(--card); border: 1px solid #334155; padding: 10px; border-radius: 8px; display: flex; justify-content: space-between; font-size: 12px; }
        .tix-num { display: inline-block; padding: 2px 4px; margin: 0 2px; border-radius: 3px; }
        .match { background: var(--win); color: white; font-weight: bold; }
        .miss { background: var(--loss); color: white; opacity: 0.8; }

        .timer-bar { font-size: 24px; font-weight: bold; color: var(--gold); margin-bottom: 10px; }
        .locked { opacity: 0.4; pointer-events: none; }
        .bet-btn { background: var(--win); color: white; border: none; width: 95%; padding: 20px; border-radius: 15px; font-size: 24px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <button onclick="document.getElementById('historySide').classList.toggle('open')" style="position:fixed; left:10px; top:10px; background:var(--gold); border:none; padding:8px; border-radius:5px; z-index:101; font-weight:bold;">HISTORY</button>

    <div id="historySide">
        <h3 style="color:var(--gold)">LAST DRAWS</h3>
        <div id="histContent"></div>
    </div>

    <div class="timer-bar" id="timer">DRAW IN: 50s</div>
    <div id="drawBoard" style="min-height:45px; margin:10px 0; display:flex; flex-wrap:wrap; justify-content:center; gap:6px;"></div>

    <div class="grid" id="kenoGrid"></div>

    <div class="selection-strip" id="selStrip">SELECT NUMBERS</div>

    <div style="margin:10px 0; font-size:16px; color:var(--gold)">Potential Win: <span id="potential">0.00</span> ETB</div>

    <div class="ticket-stack" id="ticketStack"></div>

    <div style="color:var(--gold); font-size:28px; font-weight:bold; margin:15px 0;" id="gameBal">0.00 ETB</div>

    <button class="bet-btn" id="betBtn" onclick="placeTicket()">PLACE TICKET</button>

<script>
    let balance = parseFloat(localStorage.getItem('simba_balance')) || 314;
    let bet = 10;
    let selectedNums = [];
    let placedTickets = [];
    let timeLeft = 50; 
    let isLocked = false;

    // Grid Init
    const grid = document.getElementById('kenoGrid');
    for(let i=1; i<=80; i++){
        let d = document.createElement('div');
        d.className = 'num'; d.innerText = i; d.id = 'n'+i;
        d.onclick = () => {
            if(isLocked) return;
            if(selectedNums.includes(i)) {
                selectedNums = selectedNums.filter(x => x!==i);
                document.getElementById('n'+i).classList.remove('selected');
            } else if(selectedNums.length < 8) {
                selectedNums.push(i);
                document.getElementById('n'+i).classList.add('selected');
            }
            updateSelectionUI();
        };
        grid.appendChild(d);
    }

    function updateSelectionUI() {
        document.getElementById('selStrip').innerText = selectedNums.length > 0 ? selectedNums.sort((a,b)=>a-b).join(' - ') : "SELECT NUMBERS";
        const mults = [0, 0, 2, 5, 15, 40, 100, 300, 1000];
        document.getElementById('potential').innerText = (bet * mults[selectedNums.length]).toFixed(2);
    }

    function placeTicket() {
        if(selectedNums.length < 2 || balance < bet) return;
        balance -= bet;
        placedTickets.push({ nums: [...selectedNums], bet: bet, win: 0, hits: [] });
        renderTickets();
        selectedNums = [];
        document.querySelectorAll('.num').forEach(n => n.classList.remove('selected'));
        updateSelectionUI();
        updateUI();
    }

    function renderTickets() {
        const stack = document.getElementById('ticketStack');
        stack.innerHTML = placedTickets.map((t, idx) => `
            <div class="ticket" id="tix${idx}">
                <div>TKT #${idx+1}: ${t.nums.map(n => `<span class="tix-num" id="t${idx}n${n}">${n}</span>`).join('')}</div>
                <div><b>${t.win > 0 ? 'WIN: '+t.win : 'PENDING'}</b></div>
            </div>
        `).join('');
    }

    setInterval(() => {
        if(timeLeft > 0) {
            timeLeft--;
            document.getElementById('timer').innerText = `DRAW IN: ${timeLeft}s`;
            if(timeLeft <= 10 && !isLocked) {
                isLocked = true;
                document.getElementById('betBtn').disabled = true;
                document.getElementById('betBtn').innerText = "BET LOCKED";
                grid.classList.add('locked');
            }
        } else {
            runDraw();
            timeLeft = 75; // 50s betting + 15s draw + 10s result display
        }
    }, 1000);

    async function runDraw() {
        let draw = [];
        while(draw.length < 20) {
            let n = Math.floor(Math.random()*80)+1;
            if(!draw.includes(n)) draw.push(n);
        }

        for(let n of draw) {
            await new Promise(r => setTimeout(r, 800));
            document.getElementById('n'+n).classList.add('draw-glow');
            placedTickets.forEach((t, tidx) => {
                if(t.nums.includes(n)) {
                    t.hits.push(n);
                    document.getElementById(`t${tidx}n${n}`).classList.add('match');
                }
            });
        }

        placedTickets.forEach((t, idx) => {
            const winMults = [0, 0, 2, 5, 15, 40, 100, 300, 1000];
            t.win = t.bet * winMults[t.hits.length];
            balance += t.win;
            t.nums.forEach(num => {
                if(!t.hits.includes(num)) document.getElementById(`t${idx}n${num}`).classList.add('miss');
            });
        });

        const hist = document.getElementById('histContent');
        hist.innerHTML = `<div style="font-size:11px; margin-bottom:5px;">${new Date().toLocaleTimeString()}<br>${draw.slice(0,10).join(',')}...</div>` + hist.innerHTML;

        setTimeout(() => {
            placedTickets = [];
            document.getElementById('ticketStack').innerHTML = "";
            document.querySelectorAll('.num').forEach(n => n.classList.remove('draw-glow'));
            isLocked = false;
            document.getElementById('betBtn').disabled = false;
            document.getElementById('betBtn').innerText = "PLACE TICKET";
            grid.classList.remove('locked');
            updateUI();
        }, 10000); // Wait 10 seconds before clearing results
    }

    function updateUI() {
        document.getElementById('gameBal').innerText = balance.toFixed(2) + " ETB";
        localStorage.setItem('simba_balance', balance);
    }
    updateUI();
</script>
</body>
</html>
