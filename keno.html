<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Keno | Simba Bet</title>
    <style>
        body { background-color: #111; color: white; font-family: Arial, sans-serif; text-align: center; margin: 0; padding-bottom: 20px; }
        .game-header { padding: 15px; background: #000; border-bottom: 2px solid #FFD700; display: flex; justify-content: space-between; align-items: center; }
        .balance-box { font-size: 18px; color: #FFD700; font-weight: bold; }
        .back-btn { background: #333; color: #fff; border: 1px solid #FFD700; padding: 5px 15px; border-radius: 4px; cursor: pointer; }
        .keno-board { display: grid; grid-template-columns: repeat(8, 1fr); gap: 5px; padding: 10px; max-width: 400px; margin: 0 auto; }
        .ball { width: 100%; aspect-ratio: 1; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; border: 1px solid #444; }
        .ball.selected { background: #FFD700; color: #000; border-color: #fff; }
        .ball.hit { background: #0f0; color: #000; box-shadow: 0 0 10px #0f0; }
        .controls { margin-top: 20px; padding: 10px; background: #222; }
        .bet-controls { display: flex; justify-content: center; gap: 15px; align-items: center; margin-bottom: 15px; }
        .btn-ctrl { background: #444; border: none; color: #fff; width: 40px; height: 40px; border-radius: 5px; font-size: 20px; }
        .play-btn { background: linear-gradient(45deg, #FFD700, #ff8c00); border: none; width: 80%; padding: 15px; font-size: 20px; font-weight: bold; color: #000; border-radius: 30px; cursor: pointer; }
        .play-btn:disabled { opacity: 0.5; }
        .status-msg { margin: 10px; height: 20px; color: #FFD700; }
    </style>
</head>
<body>
    <div class="game-header">
        <button class="back-btn" onclick="location.href='index.html'">EXIT</button>
        <div class="balance-box"><span id="balance">0.00</span> ETB</div>
    </div>
    <div class="status-msg" id="msg">Select up to 5 numbers</div>
    <div class="keno-board" id="board"></div>
    <div class="controls">
        <div class="bet-controls">
            <button class="btn-ctrl" onclick="adjustBet(-10)">-</button>
            <span style="font-size: 18px; font-weight: bold;">BET: <span id="betAmt">10</span></span>
            <button class="btn-ctrl" onclick="adjustBet(10)">+</button>
        </div>
        <button class="play-btn" id="playBtn" onclick="playKeno()">PLAY</button>
    </div>

    <script>
        let user = JSON.parse(localStorage.getItem('simba_active_user'));
        let balance = user ? parseFloat(user.balance) : 0;
        let bet = 10;
        let selected = [];
        let isPlaying = false;

        function saveBalance() {
            user.balance = balance.toFixed(2);
            localStorage.setItem('simba_active_user', JSON.stringify(user));
        }

        function init() {
            if (!user) window.location.href = 'index.html';
            document.getElementById('balance').innerText = balance.toFixed(2);
            const board = document.getElementById('board');
            for(let i=1; i<=40; i++) {
                let ball = document.createElement('div');
                ball.className = 'ball';
                ball.innerText = i;
                ball.id = 'b'+i;
                ball.onclick = () => toggleNum(i, ball);
                board.appendChild(ball);
            }
        }

        function toggleNum(n, el) {
            if(isPlaying) return;
            if(selected.includes(n)) {
                selected = selected.filter(x => x !== n);
                el.classList.remove('selected');
            } else if(selected.length < 5) {
                selected.push(n);
                el.classList.add('selected');
            }
        }

        function adjustBet(n) {
            if(isPlaying) return;
            if(bet + n >= 10 && bet + n <= 1000) { bet += n; document.getElementById('betAmt').innerText = bet; }
        }

        function playKeno() {
            if(selected.length === 0 || balance < bet) return;
            isPlaying = true;
            document.getElementById('playBtn').disabled = true;
            
            balance -= bet;
            saveBalance(); 
            document.getElementById('balance').innerText = balance.toFixed(2);

            let drawn = [];
            let i = 0;
            let interval = setInterval(() => {
                let r = Math.floor(Math.random() * 40) + 1;
                if(!drawn.includes(r)) {
                    drawn.push(r);
                    let b = document.getElementById('b'+r);
                    if(selected.includes(r)) b.classList.add('hit');
                    else b.style.background = '#555';
                    i++;
                }
                if(i >= 10) {
                    clearInterval(interval);
                    finishGame(drawn);
                }
            }, 150);
        }

        function finishGame(drawn) {
            let hits = selected.filter(x => drawn.includes(x)).length;
            let win = hits === 2 ? bet*2 : hits === 3 ? bet*5 : hits === 4 ? bet*20 : hits === 5 ? bet*50 : 0;
            
            if(win > 0) {
                balance += win;
                saveBalance();
                document.getElementById('msg').innerText = "WON " + win + " ETB!";
            } else {
                document.getElementById('msg').innerText = "TRY AGAIN";
            }
            document.getElementById('balance').innerText = balance.toFixed(2);
            setTimeout(() => { location.reload(); }, 2000);
        }
        window.onload = init;
    </script>
</body>
</html>
