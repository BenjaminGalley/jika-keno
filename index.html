<script>
    // FINAL MASTER URL
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz3-9pzR0vNt9pS7bPdCzY07PLOSA_0_ubOso6UfJXAVfo6bgIUQONuHCWHt8Qw1EOnfQ/exec";

    async function checkAuthStatus() {
        let activeUser = JSON.parse(localStorage.getItem('simba_active_user'));
        const headerBal = document.getElementById('headerBalance');
        const syncStatus = document.getElementById('syncStatus');

        if (activeUser) {
            // Show local balance first for speed
            headerBal.innerText = parseFloat(activeUser.balance).toFixed(2);
            
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getUser&phone=${activeUser.phone}`);
                const data = await response.json();
                if (data && data.balance !== undefined) {
                    const cloudBal = parseFloat(data.balance).toFixed(2);
                    headerBal.innerText = cloudBal;
                    activeUser.balance = cloudBal;
                    localStorage.setItem('simba_active_user', JSON.stringify(activeUser));
                    syncStatus.innerText = "Synced ✅";
                }
            } catch (e) { syncStatus.innerText = "Offline ⚠️"; }
        }
    }
    window.addEventListener('DOMContentLoaded', checkAuthStatus);
</script>
