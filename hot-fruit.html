<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hot Fruit | Simba Bet</title>
    <style>
        :root { --gold: #fbbf24; --bg: #0b0d17; --win: #f59e0b; }
        body { 
            background: var(--bg) url('assets/assets/bg.jpg.jpeg') no-repeat center center fixed; 
            background-size: cover; color: white; font-family: sans-serif; margin: 0; padding: 10px;
            display: flex; flex-direction: column; align-items: center;
        }

        .top-bar { width: 100%; display: flex; justify-content: space-between; padding: 10px; background: rgba(0,0,0,0.8); border-bottom: 2px solid var(--gold); box-sizing: border-box; }
        .balance-box { color: var(--gold); font-weight: bold; border: 1px solid var(--gold); padding: 5px 15px; border-radius: 5px; }

        /* MAIN GAME AREA */
        .game-area { display: flex; align-items: center; gap: 15px; margin-top: 20px; }
        
        .game-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 8px; padding: 12px;
            background: rgba(0,0,0,0.9); 
            border: 4px solid #444; border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        /* SIDE MULTIPLIER */
        .side-multiplier { width: 70px; border-radius: 5px; border: 2px solid #222; transition: 0.4s; filter: grayscale(100%); }
        .multiplier-active { border-color: #ff4500; box-shadow: 0 0 25px #ff4500; transform: scale(1.1); filter: grayscale(0%); }

        /* SYMBOLS */
        .symbol-box { 
            width: 80px; height: 80px; background: #fff; border-radius: 5px; 
            overflow: hidden; border: 2px solid #333; transition: 0.1s;
        }
        .symbol-box img { width: 100%; height: 100%; object-fit: cover; }
        .win-glow { border-color: #ff4500; box-shadow: 0 0 15px #ff4500; z-index: 10; transform: scale(1.05); }

        /* CONTROLS */
        .controls { margin-top: 25px; text-align: center; background: rgba(0,0,0,0.85); padding: 15px; border-radius: 15px; width: 95%; max-width: 380px; border: 1px solid #444; }
        
        .bet-controls { display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 15px; }
        .ctrl-btn { background: #111; color: var(--gold); border: 2px solid var(--gold); width: 45px; height: 45px; border-radius: 10px; font-size: 24px; cursor: pointer; font-weight: bold; }
        
        .spin-btn { 
            background: linear-gradient(180deg, #ef4444, #991b1b); border: none; 
            padding: 15px; font-size: 22px; font-weight: bold; border-radius: 8px; 
            cursor: pointer; box-shadow: 0 5px 0 #7f1d1d; width: 100%; color: white; text-transform: uppercase;
        }
        .spin-btn:active { transform: translateY(3px); box-shadow: none; }
        .spin-btn:disabled { background: #333; color: #666; box-shadow: none; cursor: not-allowed; }

        #status { height: 35px; margin: 10px 0; color: #ff4500; font-weight: bold; font-size: 20px; text-shadow: 0 0 10px rgba(255,69,0,0.5); }
        .blur { filter: blur(4px); opacity: 0.6; }
    </style>
</head>
<body>

    <div class="top-bar">
        <button onclick="location.href='index.html'" style="background:var(--gold); border:none; padding:8px 15px; font-weight:bold; border-radius:5px; cursor:pointer;">LOBBY</button>
        <div class="balance-box">BAL: <span id="gameBal">0.00</span> ETB</div>
    </div>

    <div id="status">HOT FRUIT</div>

    <div class="game-area">
        <img src="assets/assets/multiplier.jpg" id="sideMult" class="side-multiplier" alt="Payouts">

        <div class="game-grid" id="mainGrid">
            <div class="symbol-box"><img id="s0" src="assets/assets/gold_7.jpg"></div>
            <div class="symbol-box"><img id="s1" src="assets/assets/gold_7.jpg"></div>
            <div class="symbol-box"><img id="s2" src="assets/assets/gold_7.jpg"></div>
            <div class="symbol-box"><img id="s3" src="assets/assets/gold_7.jpg"></div>
            <div class="symbol-box"><img id="s4" src="assets/assets/gold_7.jpg"></div>
            <div class="symbol-box"><img id="s5" src="assets/assets/gold_7.jpg"></div>
            <div class="symbol-box"><img id="s6" src="assets/assets/gold_7.jpg"></div>
            <div class="symbol-box"><img id="s7" src="assets/assets/gold_7.jpg"></div>
            <div class="symbol-box"><img id="s8" src="assets/assets/gold_7.jpg"></div>
        </div>
    </div>

    <div class="controls">
        <div class="bet-controls">
            <button class="ctrl-btn" onclick="changeBet(-2)">-</button>
            <div style="font-weight:bold; font-size: 20px;">BET: <span id="displayBet">2</span> ETB</div>
            <button class="ctrl-btn" onclick="changeBet(2)">+</button>
        </div>
        <button class="spin-btn" id="spinBtn" onclick="spin()">SPIN</button>
    </div>

    <script>
        const symbols = [
            { id: 'gold_7', img: 'assets/assets/gold_7.jpg', mult: 50 },
            { id: 'diamond', img: 'assets/assets/diamond.jpg', mult: 20 },
            { id: 'grapes', img: 'assets/assets/grapes.jpg', mult: 10 },
            { id: 'lemon', img: 'assets/assets/lemon.jpg', mult: 5 },
            { id: 'melon', img: 'assets/assets/melon.jpg', mult: 5 },
            { id: 'orange', img: 'assets/assets/orange.jpg', mult: 2 },
            { id: 'cherry', img: 'assets/assets/cherry.jpg', mult: 2 }
        ];

        let activeUser = JSON.parse(localStorage.getItem('simba_active_user'));
        let currentBet = 2;

        function updateUI() {
            activeUser = JSON.parse(localStorage.getItem('simba_active_user'));
            if(activeUser) document.getElementById('gameBal').innerText = parseFloat(activeUser.balance).toFixed(2);
        }

        function changeBet(val) {
            currentBet += val;
            if(currentBet < 2) currentBet = 2;
            document.getElementById('displayBet').innerText = currentBet;
        }

        function spin() {
            if(!activeUser || activeUser.balance < currentBet) return alert("Insufficient Balance!");

            activeUser.balance -= currentBet;
            saveState();
            updateUI();

            const btn = document.getElementById('spinBtn');
            const sideMult = document.getElementById('sideMult');
            btn.disabled = true;
            sideMult.classList.remove('multiplier-active');
            document.getElementById('status').innerText = "SPINNING...";
            
            for(let i=0; i<9; i++) document.getElementById(`s${i}`).parentElement.classList.remove('win-glow');

            let spins = 0;
            const interval = setInterval(() => {
                for(let i=0; i<9; i++) {
                    const randomSym = symbols[Math.floor(Math.random() * symbols.length)];
                    const img = document.getElementById(`s${i}`);
                    img.src = randomSym.img;
                    img.classList.add('blur');
                }
                spins++;

                if(spins > 12) {
                    clearInterval(interval);
                    stopSpin();
                }
            }, 90);
        }

        function stopSpin() {
            let results = [];
            for(let i=0; i<9; i++) {
                const finalSym = symbols[Math.floor(Math.random() * symbols.length)];
                const img = document.getElementById(`s${i}`);
                img.src = finalSym.img;
                img.classList.remove('blur');
                results.push(finalSym);
            }

            calculateWins(results);
            document.getElementById('spinBtn').disabled = false;
        }

        function calculateWins(res) {
            let totalWin = 0;
            const lines = [
                [0,1,2], [3,4,5], [6,7,8], // Rows
                [0,3,6], [1,4,7], [2,5,8], // Columns
                [0,4,8], [2,4,6]           // Diagonals
            ];

            let won = false;
            lines.forEach(line => {
                if(res[line[0]].id === res[line[1]].id && res[line[1]].id === res[line[2]].id) {
                    totalWin += currentBet * res[line[0]].mult;
                    won = true;
                    line.forEach(idx => document.getElementById(`s${idx}`).parentElement.classList.add('win-glow'));
                }
            });

            if(won) {
                activeUser.balance += totalWin;
                document.getElementById('sideMult').classList.add('multiplier-active');
                document.getElementById('status').innerText = `WIN: +${totalWin.toFixed(2)} ETB`;
                saveState();
                updateUI();
            } else {
                document.getElementById('status').innerText = "TRY AGAIN";
            }
        }

        function saveState() {
            localStorage.setItem('simba_active_user', JSON.stringify(activeUser));
            localStorage.setItem(`user_${activeUser.phone}`, JSON.stringify(activeUser));
        }

        window.onload = updateUI;
    </script>
</body>
</html>
