<script>
    // ✅ 1. YOUR MASTER URL (Double check this is the one from your Sheet)
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyr8EHHAKYy7q1QyCHVnsFZgPrX2FkAyKa_mSwh4yDz3IFHaO9dBCvN-kaNuG5hZz2P/exec";

    async function handleRegister() {
        // These MUST match the "id" of your input boxes
        const name = document.querySelector('input[placeholder="Full Name"]').value;
        const phone = document.querySelector('input[placeholder="Phone Number (09...)"]').value;
        const pass = document.querySelector('input[placeholder="Create Password"]').value;
        const btn = document.getElementById('regBtn') || document.querySelector('button');

        if (!name || !phone || !pass) {
            alert("Please fill in all fields!");
            return;
        }

        btn.innerText = "Connecting...";
        btn.disabled = true;

        // ✅ 2. This sends the data to your Google Sheet
        const finalUrl = `${SCRIPT_URL}?action=register&name=${encodeURIComponent(name)}&phone=${phone}&pass=${encodeURIComponent(pass)}`;

        try {
            // Using 'no-cors' mode to bypass browser blocks
            await fetch(finalUrl, { mode: 'no-cors' });

            // Save user data locally so they stay logged in
            const userData = {
                name: name,
                phone: phone,
                balance: 0,
                id: "SB-" + phone.slice(-4)
            };
            localStorage.setItem('simba_active_user', JSON.stringify(userData));

            alert("Registration Successful! Redirecting...");
            window.location.href = 'index.html';

        } catch (error) {
            alert("Connection error. Check your internet.");
            btn.innerText = "Create Account";
            btn.disabled = false;
        }
    }
</script>
