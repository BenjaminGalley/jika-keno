<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fast Keno | Simba Bet</title>
    <style>
        :root { --gold: #FFD700; --green: #2ecc71; --red: #e74c3c; }
        body { background: #0b0f19; color: white; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding-bottom: 100px; display: flex; flex-direction: column; align-items: center; }
        .top-nav { width: 100%; background: #1a1f2e; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--gold); box-sizing: border-box; }
        .bal-display { color: var(--gold); font-weight: 900; font-size: 1.2rem; }
        .timer-section { width: 90%; max-width: 400px; background: #1e2536; margin: 15px 0; padding: 15px; border-radius: 12px; text-align: center; border: 1px solid #3d4455; }
        #timer { font-size: 28px; color: var(--gold); font-weight: bold; }
        .keno-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px; width: 95%; max-width: 450px; }
        .cell { background: #2c344a; aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 14px; border-radius: 4px; border: 1px solid #454d66; cursor: pointer; position: relative; }
        .cell.selected { background: var(--gold); color: #000; }
        .cell.hit::after { content: '✔'; position: absolute; color: var(--green); font-size: 20px; font-weight: 900; }
        .cell.miss::after { content: '✘'; position: absolute; color: var(--red); font-size: 20px; font-weight: 900; }
        .bottom-ui { position: fixed; bottom: 0; width: 100%; background: #1a1f2e; border-top: 2px solid var(--gold); padding: 15px 0; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .btn-play { background: linear-gradient(180deg, #FFD700, #DAA520); color: black; padding: 12px 40px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-play:disabled { opacity: 0.5; }
    </style>
</head>
<body>
    <div class="top-nav">
        <button onclick="location.href='index.html'" style="background:#333; color:white; border:none; padding:8px 15px; border-radius:5px;">LOBBY</button>
        <div class="bal-display"><span id="user-bal">0.00</span> ETB</div>
    </div>
    <div class="timer-section">
        <div id="timer">00:15</div>
        <div style="font-size:12px; color:#888;">NEXT DRAW</div>
    </div>
    <div class="keno-grid" id="kenoGrid"></div>
    <div class="bottom-ui">
        <div style="font-weight:bold;">BET: <span id="currentBet">2</span> ETB</div>
        <button class="btn-play" id="playBtn" onclick="playGame()" disabled>PLAY NOW</button>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz4mHgkhNimPEi8HSWbIbNIrIdLno8zYnYxbAQTtrk96MC6ILvN1QY-zRgwmJfmRMxADA/exec";
        let user = JSON.parse(localStorage.getItem('simba_active_user'));
        let balance = user ? parseFloat(user.balance) : 0;
        let bet = 2;
        let selected = [];
        let drawing = false;

        function init() {
            document.getElementById('user-bal').innerText = balance.toFixed(2);
            for(let i=1; i<=80; i++) {
                let c = document.createElement('div');
                c.className = 'cell'; c.innerText = i;
                c.onclick = () => {
                    if(drawing) return;
                    if(selected.includes(i)) { selected = selected.filter(n => n!==i); c.classList.remove('selected'); }
                    else if(selected.length < 10) { selected.push(i); c.classList.add('selected'); }
                    document.getElementById('playBtn').disabled = selected.length === 0;
                };
                document.getElementById('kenoGrid').appendChild(c);
            }
        }

        async function syncBalance() {
            user.balance = balance.toFixed(2);
            localStorage.setItem('simba_active_user', JSON.stringify(user));
            document.getElementById('user-bal').innerText = balance.toFixed(2);
            // Send to Google Sheet
            try { await fetch(`${SCRIPT_URL}?action=updateBalance&phone=${user.phone}&balance=${balance.toFixed(2)}`); } catch(e) {}
        }

        async function playGame() {
            if(balance < bet || drawing) return;
            drawing = true;
            balance -= bet;
            await syncBalance();
            
            // Logic for drawing (Simplified for display)
            let draws = []; while(draws.length < 20) { let r = Math.floor(Math.random()*80)+1; if(!draws.includes(r)) draws.push(r); }
            let hits = 0;
            for(let n of draws) {
                await new Promise(r => setTimeout(r, 100));
                let el = document.getElementById('kenoGrid').children[n-1];
                if(selected.includes(n)) { el.classList.add('hit'); hits++; } else { el.classList.add('miss'); }
            }

            if(hits >= 2) { balance += (bet * hits); await syncBalance(); alert("Win: " + (bet*hits)); }
            drawing = false;
            selected = [];
            document.querySelectorAll('.cell').forEach(c => c.classList.remove('selected','hit','miss'));
        }
        init();
    </script>
</body>
</html>
