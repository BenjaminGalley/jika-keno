<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fast Keno 80 | Simba Bet</title>
    <link href="https://fonts.googleapis.com/css2?family=Goldman:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #fcc201; --blue: #00f2ff; --glass: rgba(0, 0, 0, 0.9); }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: #000; 
            color: white; 
            font-family: 'Goldman', sans-serif; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
        }

        /* Fixed Header */
        .header { 
            display: flex; 
            justify-content: space-between; 
            padding: 10px; 
            background: #111; 
            border-bottom: 2px solid var(--gold); 
            align-items: center;
            z-index: 100;
        }

        /* Timer Bar */
        .status-bar { 
            background: #053305; 
            padding: 5px; 
            border-bottom: 1px solid var(--blue); 
            text-align: center; 
        }
        .timer { color: var(--blue); font-weight: bold; font-size: 18px; }

        .game-body { 
            flex: 1; 
            display: flex; 
            overflow: hidden; 
            position: relative; 
        }

        /* Sidebar - Winning Numbers */
        .side-board { 
            width: 55px; 
            background: #111; 
            border-right: 1px solid #333; 
            overflow-y: auto; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 4px; 
            padding: 5px 0; 
        }
        .side-ball { 
            width: 30px; 
            height: 30px; 
            background: var(--blue); 
            color: #000; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 12px; 
            font-weight: bold; 
            animation: pop 0.3s forwards; 
        }

        /* Main Grid Area */
        .main-content { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
        }

        .keno-grid { 
            display: grid; 
            grid-template-columns: repeat(10, 1fr); 
            gap: 3px; 
            padding: 8px; 
            background: #000;
        }
        
        .num-btn { 
            aspect-ratio: 1; 
            background: #222; 
            border: 1px solid #444; 
            color: white; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 13px; 
            border-radius: 4px; 
        }
        .num-btn.selected { background: var(--gold); color: #000; font-weight: bold; }
        .num-btn.locked { opacity: 0.4; }

        /* Ticket Tray - Always Visible */
        .ticket-tray { 
            height: 100px; 
            display: flex; 
            overflow-x: auto; 
            gap: 10px; 
            padding: 8px; 
            background: #0a0a0a; 
            border-top: 1px solid #333; 
        }
        .ticket { 
            min-width: 140px; 
            background: #1a1a1a; 
            border: 1px solid #444; 
            border-radius: 8px; 
            padding: 6px; 
            font-size: 10px; 
        }
        .t-nums { display: flex; flex-wrap: wrap; gap: 3px; margin-top: 4px; }
        .t-ball { 
            width: 20px; 
            height: 20px; 
            background: #333; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 10px; 
        }
        .t-ball.hit { background: #28a745 !important; color: white; font-weight: bold; box-shadow: 0 0 5px #28a745; }

        /* Fancy Number Pop-up */
        #drawPopup { 
            position: absolute; 
            top: 40%; 
            left: 55%; 
            transform: translate(-50%, -50%); 
            font-size: 100px; 
            font-weight: 900; 
            color: var(--blue); 
            text-shadow: 0 0 30px var(--blue); 
            z-index: 1000; 
            display: none; 
            pointer-events: none;
        }

        /* Fixed Footer for Mobile */
        .footer { 
            background: #111; 
            border-top: 2px solid var(--gold); 
            padding: 10px 15px 25px 15px; /* Added bottom padding for mobile home bars */
        }
        .bet-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .bet-display { font-size: 18px; color: var(--gold); font-weight: bold; }
        .place-bet-btn { 
            width: 100%; 
            padding: 16px; 
            background: var(--gold); 
            border: none; 
            border-radius: 12px; 
            font-weight: 900; 
            font-size: 22px; 
            color: #000; 
            box-shadow: 0 4px 0 #b88e00;
        }
        .place-bet-btn:active { transform: translateY(2px); box-shadow: none; }
        .place-bet-btn:disabled { background: #444; color: #888; box-shadow: none; }

        @keyframes pop { from { transform: scale(0); } to { transform: scale(1); } }
    </style>
</head>
<body>

    <div class="header">
        <button onclick="location.href='index.html'" style="background:none; border:1px solid var(--gold); color:var(--gold); padding:5px 10px; border-radius:5px;">LOBBY</button>
        <button id="musicBtn" onclick="toggleMusic()" style="background:#222; border:1px solid var(--gold); color:var(--gold); padding:5px; border-radius:5px; font-size:10px;">ðŸŽµ START MUSIC</button>
        <div class="bal-value"><span id="bal">0.00</span> <small>ETB</small></div>
    </div>

    <div class="status-bar">
        <div class="timer" id="timer">NEXT DRAW: 00:60</div>
    </div>

    <div class="game-body">
        <div class="side-board" id="sideBoard"></div>
        <div class="main-content">
            <div id="drawPopup">00</div>
            <div class="keno-grid" id="grid"></div>
            <div class="ticket-tray" id="ticketTray"></div>
        </div>
    </div>

    <div class="footer">
        <div class="bet-row">
            <div style="font-size: 12px; color: #aaa;">Potential Win: <span id="potWin" style="color:var(--blue)">0.00</span></div>
            <div class="bet-display">
                <button onclick="adjBet(-2)" style="background:none; border:1px solid var(--gold); color:var(--gold); width:30px; height:30px; border-radius:50%;">-</button>
                <span id="betDisp" style="margin: 0 10px;">2</span>
                <button onclick="adjBet(2)" style="background:none; border:1px solid var(--gold); color:var(--gold); width:30px; height:30px; border-radius:50%;">+</button>
            </div>
        </div>
        <button class="place-bet-btn" id="betBtn" onclick="placeBet()">PLACE BET</button>
    </div>

    <audio id="bgMusic" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>
    <audio id="sndPop" src="https://assets.mixkit.co/active_storage/sfx/2045/2045-preview.mp3"></audio>

    <script>
        let selected = [];
        let balance = 0;
        let currentBet = 2;
        let timeLeft = 60;
        let tickets = [];
        let isLocked = false;
        let musicStarted = false;

        // Payout Logic: [Matched 0, Matched 1, Matched 2, Matched 3, Matched 4...]
        // Multiplier based on a 2 Birr bet
        const PAYOUT_LOGIC = {
            2: [0, 0, 50],       // 2 numbers picked: match 2 = 50
            3: [0, 0, 0, 100],   // 3 numbers picked: match 3 = 100
            4: [0, 0, 0, 0, 160] // 4 numbers picked: match 4 = 160
        };

        function init() {
            let user = JSON.parse(localStorage.getItem('simba_active_user')) || {balance: "0.00"};
            balance = parseFloat(user.balance);
            updateUI();
            
            const grid = document.getElementById('grid');
            for(let i=1; i<=80; i++) {
                let d = document.createElement('div');
                d.className = 'num-btn';
                d.innerText = i;
                d.id = `n${i}`;
                d.onclick = () => toggle(i);
                grid.appendChild(d);
            }
            startTimer();
        }

        function toggleMusic() {
            const m = document.getElementById('bgMusic');
            if(!musicStarted) {
                m.play();
                document.getElementById('musicBtn').innerText = "ðŸŽµ MUSIC ON";
                musicStarted = true;
            } else {
                if(m.paused) { m.play(); document.getElementById('musicBtn').innerText = "ðŸŽµ MUSIC ON"; }
                else { m.pause(); document.getElementById('musicBtn').innerText = "ðŸŽµ MUSIC OFF"; }
            }
        }

        function toggle(n) {
            if(isLocked) return;
            const el = document.getElementById(`n${n}`);
            if(selected.includes(n)) {
                selected = selected.filter(x => x !== n);
                el.classList.remove('selected');
            } else if(selected.length < 4) { // Limits to 4 based on your specific payout request
                selected.push(n);
                el.classList.add('selected');
            }
            updatePotential();
        }

        function updatePotential() {
            let count = selected.length;
            let win = 0;
            if(count >= 2 && PAYOUT_LOGIC[count]) {
                win = PAYOUT_LOGIC[count][count] * (currentBet / 2);
            }
            document.getElementById('potWin').innerText = win.toFixed(2) + " ETB";
        }

        function adjBet(v) {
            if(isLocked) return;
            if(currentBet + v >= 2) { 
                currentBet += v; 
                updateUI(); 
                updatePotential();
            }
        }

        function placeBet() {
            if(selected.length < 2) return alert("Pick at least 2 numbers");
            if(balance < currentBet) return alert("Insufficient Balance");

            balance -= currentBet;
            tickets.push({
                id: tickets.length + 1,
                nums: [...selected],
                amt: currentBet,
                type: selected.length
            });
            
            renderTickets();
            
            // Clear Table Immediately for next bet
            selected = [];
            document.querySelectorAll('.num-btn').forEach(b => b.classList.remove('selected'));
            updateUI();
            updatePotential();

            // Auto-scroll to newest ticket
            const tray = document.getElementById('ticketTray');
            tray.scrollLeft = tray.scrollWidth;
        }

        function renderTickets() {
            const tray = document.getElementById('ticketTray');
            tray.innerHTML = tickets.map(t => `
                <div class="ticket">
                    <div><b>TICKET #${t.id}</b></div>
                    <div>Bet: ${t.amt} ETB</div>
                    <div class="t-nums">
                        ${t.nums.map(n => `<div class="t-ball" id="tb-${t.id}-${n}">${n}</div>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        function startTimer() {
            setInterval(() => {
                if(timeLeft > 0) {
                    timeLeft--;
                    document.getElementById('timer').innerText = `NEXT DRAW: 00:${timeLeft < 10 ? '0'+timeLeft : timeLeft}`;
                    if(timeLeft === 3) {
                        isLocked = true;
                        document.getElementById('betBtn').disabled = true;
                        document.querySelectorAll('.num-btn').forEach(b => b.classList.add('locked'));
                    }
                } else {
                    runDraw();
                }
            }, 1000);
        }

        async function runDraw() {
            let drawn = [];
            const side = document.getElementById('sideBoard');
            const popup = document.getElementById('drawPopup');
            side.innerHTML = '';
            popup.style.display = 'block';

            for(let i=0; i<20; i++) {
                let r = Math.floor(Math.random()*80)+1;
                while(drawn.includes(r)) r = Math.floor(Math.random()*80)+1;
                drawn.push(r);
                
                popup.innerText = r;
                document.getElementById('sndPop').currentTime = 0;
                document.getElementById('sndPop').play();

                let ball = document.createElement('div');
                ball.className = 'side-ball';
                ball.innerText = r;
                side.prepend(ball);

                // Highlight ticket hits live
                tickets.forEach(t => {
                    if(t.nums.includes(r)) {
                        let tb = document.getElementById(`tb-${t.id}-${r}`);
                        if(tb) tb.classList.add('hit');
                    }
                });

                await new Promise(res => setTimeout(res, 500));
            }

            popup.style.display = 'none';
            calculateWins(drawn);
            setTimeout(resetForNextRound, 5000);
        }

        function calculateWins(drawn) {
            let totalWin = 0;
            tickets.forEach(t => {
                let hits = t.nums.filter(n => drawn.includes(n)).length;
                let win = (PAYOUT_LOGIC[t.type] && PAYOUT_LOGIC[t.type][hits]) || 0;
                totalWin += win * (t.amt / 2);
            });
            if(totalWin > 0) {
                balance += totalWin;
                updateUI();
                alert("YOU WON " + totalWin.toFixed(2) + " ETB!");
            }
        }

        function resetForNextRound() {
            tickets = [];
            timeLeft = 60;
            isLocked = false;
            document.getElementById('ticketTray').innerHTML = '';
            document.getElementById('sideBoard').innerHTML = '';
            document.getElementById('betBtn').disabled = false;
            document.querySelectorAll('.num-btn').forEach(b => b.classList.remove('locked'));
            updateUI();
        }

        function updateUI() {
            document.getElementById('bal').innerText = balance.toFixed(2);
            document.getElementById('betDisp').innerText = currentBet;
            let user = JSON.parse(localStorage.getItem('simba_active_user')) || {};
            user.balance = balance.toFixed(2);
            localStorage.setItem('simba_active_user', JSON.stringify(user));
        }

        window.onload = init;
    </script>
</body>
</html>
