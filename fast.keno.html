<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fast Keno | Simba Bet</title>
    <style>
        :root { 
            --gold: #FFD700; --cyan: #00f2ff; --green: #2ecc71; 
            --red: #e74c3c; --bg: #05070a; --panel: #1a1e26;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        body { 
            background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; 
            overflow: hidden; display: flex; flex-direction: column; height: 100vh;
        }

        .header { 
            background: var(--panel); height: 45px; display: flex; 
            justify-content: space-between; align-items: center; padding: 0 15px;
            border-bottom: 2px solid var(--gold); flex-shrink: 0;
        }

        .timer-bar { 
            background: #000; color: var(--cyan); text-align: center; 
            font-size: 24px; font-weight: bold; height: 35px; line-height: 35px;
            border-bottom: 1px solid #333; flex-shrink: 0;
        }

        .game-area { display: flex; flex: 1; min-height: 0; position: relative; }
        
        /* Draw Sidebar */
        .draw-sidebar {
            width: 45px; background: #111; border-right: 1px solid #333;
            display: none; flex-direction: column; overflow-y: auto; padding: 5px 0;
        }
        .side-ball { 
            width: 32px; height: 32px; margin: 2px auto; border-radius: 50%; 
            background: var(--gold); color: black; font-weight: 900; 
            display: flex; align-items: center; justify-content: center; font-size: 14px;
        }

        .grid-container { flex: 1; display: flex; align-items: center; justify-content: center; padding: 5px; }
        .grid { 
            display: grid; grid-template-columns: repeat(10, 1fr); gap: 3px; 
            width: 100%; max-width: 360px;
        }
        .cell { 
            background: #242f3e; aspect-ratio: 1; display: flex; 
            align-items: center; justify-content: center; font-size: 14px; 
            font-weight: bold; border: 1px solid #3d4b5f; border-radius: 4px;
        }
        .cell.selected { background: var(--cyan); color: black; border-color: white; }
        .cell.hit { background: var(--green) !important; color: white; box-shadow: 0 0 10px var(--green); }

        /* LIVE CALCULATOR AREA (Below Table) */
        .live-calc-area {
            background: #000; padding: 8px 15px; border-top: 1px solid #333;
            display: flex; flex-direction: column; gap: 5px; min-height: 50px;
        }
        .calc-nums { display: flex; flex-wrap: wrap; gap: 5px; min-height: 20px; }
        .calc-ball { width: 22px; height: 22px; background: var(--cyan); color: black; border-radius: 50%; font-size: 11px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .win-estimate { color: var(--green); font-weight: bold; font-size: 14px; }

        /* TICKETS DISPLAY */
        .tickets-container {
            height: 80px; background: #0a0e14; border-top: 1px solid #444;
            display: flex; overflow-x: auto; padding: 8px; gap: 10px; flex-shrink: 0;
        }
        .ticket-card {
            min-width: 140px; background: #1c222d; border: 1px solid var(--gold);
            border-radius: 6px; padding: 6px; flex-shrink: 0;
        }
        .ticket-header { font-size: 9px; color: var(--gold); display: flex; justify-content: space-between; border-bottom: 1px solid #333; margin-bottom: 4px; }
        .ticket-nums { display: flex; flex-wrap: wrap; gap: 3px; }
        .tn { width: 18px; height: 18px; font-size: 9px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .tn.hit { background: var(--green); color: white; }

        /* BOTTOM UI - Moved up */
        .bottom-ui { 
            background: var(--panel); padding: 10px 15px 30px 15px; /* Added more padding-bottom for mobile safety */
            flex-shrink: 0; border-top: 2px solid var(--gold);
        }
        .ctrl-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
        .bet-box { display: flex; align-items: center; background: #000; border: 2px solid var(--gold); border-radius: 20px; }
        .b-btn { background: none; border: none; color: var(--gold); padding: 5px 12px; font-size: 22px; font-weight: bold; }
        #betVal { width: 40px; text-align: center; background: none; border: none; color: white; font-weight: bold; font-size: 16px; }
        .play-btn { 
            flex: 1; height: 45px; background: linear-gradient(180deg, var(--gold), #b8860b); 
            border: none; border-radius: 20px; font-weight: 900; font-size: 18px; color: #000;
        }
        .play-btn:disabled { opacity: 0.4; filter: grayscale(1); }

        #draw-ball { 
            position: fixed; top: 35%; left: 50%; transform: translate(-50%, -50%); 
            width: 100px; height: 100px; background: white; border-radius: 50%; 
            color: black; font-size: 45px; font-weight: 900; display: none; 
            align-items: center; justify-content: center; border: 5px solid var(--cyan); z-index: 500;
        }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
    </style>
</head>
<body onclick="startAudio()">

    <audio id="bgMusic" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3"></audio>
    <audio id="sndPop" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>

    <div class="header">
        <div style="color:var(--gold); font-weight:bold;">SIMBA BET</div>
        <div style="font-size: 14px;">BAL: <span id="liveBal" style="color:var(--green)">1716.50</span></div>
        <div id="muteBtn" onclick="toggleMute()" style="cursor:pointer;">ðŸ”Š</div>
    </div>

    <div class="timer-bar" id="timer">00:60</div>

    <div class="game-area">
        <div class="draw-sidebar" id="drawSide"></div>
        <div class="grid-container">
            <div class="grid" id="mainGrid"></div>
        </div>
    </div>

    <div class="live-calc-area">
        <div class="calc-nums" id="calcNums">Pick numbers...</div>
        <div class="win-estimate" id="potentialWin">Max Payout: 0.00 ETB</div>
    </div>

    <div id="draw-ball">0</div>

    <div class="tickets-container" id="ticketDisplay"></div>

    <div class="bottom-ui">
        <div class="ctrl-row">
            <div class="bet-box">
                <button class="b-btn" onclick="adjBet(-2)">-</button>
                <input type="number" id="betVal" value="2" readonly>
                <button class="b-btn" onclick="adjBet(2)">+</button>
            </div>
            <button class="play-btn" id="betBtn" onclick="placeBet()" disabled>PLACE BET</button>
        </div>
    </div>

    <div id="winOverlay" class="modal">
        <h1 style="color:var(--gold); font-size:40px;">BIG WIN!</h1>
        <p id="winText" style="font-size:24px; font-weight:bold;"></p>
        <button class="play-btn" style="width:120px; margin-top:20px;" onclick="closeWin()">OK</button>
    </div>

    <script>
        let balance = 1716.50;
        let selected = [];
        let tickets = [];
        let currentBet = 2;
        let timeLeft = 60;
        let tableLocked = false;
        let isMuted = false;
        let audioStarted = false;

        const PAYOUTS = { 1:0, 2:10, 3:25, 4:50, 5:100, 6:300, 7:1000, 8:5000, 9:15000, 10:50000 };

        function init() {
            const g = document.getElementById('mainGrid');
            for(let i=1; i<=80; i++) {
                let c = document.createElement('div');
                c.className = 'cell'; c.id = 'n'+i; c.innerText = i;
                c.onclick = () => selectNum(i);
                g.appendChild(c);
            }
            updateUI();
        }

        function selectNum(n) {
            if(tableLocked) return;
            const el = document.getElementById('n'+n);
            if(selected.includes(n)) {
                selected = selected.filter(x => x !== n);
                el.classList.remove('selected');
            } else if(selected.length < 10) {
                selected.push(n);
                el.classList.add('selected');
            }
            updateUI();
        }

        function updateUI() {
            // Update Live Calculator Balls
            const calcBox = document.getElementById('calcNums');
            if(selected.length > 0) {
                calcBox.innerHTML = selected.map(n => `<div class="calc-ball">${n}</div>`).join('');
            } else {
                calcBox.innerHTML = "Pick numbers...";
            }

            // Calculate Potential Win based on how many numbers picked
            let multiplier = PAYOUTS[selected.length] || 0;
            let possible = currentBet * multiplier;
            document.getElementById('potentialWin').innerText = `Max Payout: ${possible.toFixed(2)} ETB`;

            // Bet Button State
            document.getElementById('betBtn').disabled = (selected.length === 0 || tableLocked);
            document.getElementById('liveBal').innerText = balance.toFixed(2);
        }

        function adjBet(v) {
            currentBet = Math.max(2, currentBet + v);
            document.getElementById('betVal').value = currentBet;
            updateUI();
        }

        function placeBet() {
            if(balance < currentBet) return alert("Low Balance");
            balance -= currentBet;
            
            // Add ticket
            tickets.push({ nums: [...selected], bet: currentBet });
            renderTickets();
            
            // CLEAR TABLE AUTOMATICALLY
            selected.forEach(n => document.getElementById('n'+n).classList.remove('selected'));
            selected = [];
            
            updateUI();
        }

        function renderTickets() {
            const container = document.getElementById('ticketDisplay');
            container.innerHTML = tickets.map((t, i) => `
                <div class="ticket-card">
                    <div class="ticket-header"><span>TK #${i+1}</span> <span>${t.bet} ETB</span></div>
                    <div class="ticket-nums">
                        ${t.nums.map(n => `<div class="tn" id="tn-${i}-${n}">${n}</div>`).join('')}
                    </div>
                </div>
            `).join('');
            container.scrollLeft = container.scrollWidth;
        }

        function startGlobalTimer() {
            setInterval(() => {
                if(timeLeft > 0) {
                    timeLeft--;
                    document.getElementById('timer').innerText = "00:" + (timeLeft < 10 ? "0"+timeLeft : timeLeft);
                    if(timeLeft <= 3) tableLocked = true;
                } else {
                    runDraw();
                    timeLeft = 60;
                }
            }, 1000);
        }

        async function runDraw() {
            tableLocked = true;
            let drawn = [];
            const side = document.getElementById('drawSide');
            const ballPopup = document.getElementById('draw-ball');
            side.style.display = 'flex';
            side.innerHTML = "";

            for(let i=0; i<20; i++) {
                let n; do { n = Math.floor(Math.random()*80)+1; } while(drawn.includes(n));
                drawn.push(n);

                // Side board & popup
                side.innerHTML += `<div class="side-ball">${n}</div>`;
                side.scrollTop = side.scrollHeight;
                ballPopup.innerText = n; ballPopup.style.display = 'flex';
                
                // Highlight Grid & Tickets
                document.getElementById('n'+n).classList.add('hit');
                tickets.forEach((t, tIdx) => {
                    if(t.nums.includes(n)) {
                        const tnEl = document.getElementById(`tn-${tIdx}-${n}`);
                        if(tnEl) tnEl.classList.add('hit');
                    }
                });

                if(!isMuted) document.getElementById('sndPop').play();
                await new Promise(r => setTimeout(r, 800));
                ballPopup.style.display = 'none';
            }

            // Results
            let winTotal = 0;
            tickets.forEach(t => {
                let matches = t.nums.filter(n => drawn.includes(n)).length;
                if(matches >= 2) winTotal += t.bet * (PAYOUTS[matches] / 10); 
            });

            if(winTotal > 0) {
                balance += winTotal;
                document.getElementById('winText').innerText = winTotal.toFixed(2) + " ETB";
                document.getElementById('winOverlay').style.display = 'flex';
            }

            setTimeout(resetGame, 5000);
        }

        function resetGame() {
            closeWin();
            document.getElementById('drawSide').style.display = 'none';
            document.querySelectorAll('.cell').forEach(c => c.className = 'cell');
            tickets = [];
            document.getElementById('ticketDisplay').innerHTML = "";
            tableLocked = false;
            updateUI();
        }

        function closeWin() { document.getElementById('winOverlay').style.display = 'none'; }

        function startAudio() {
            if(!audioStarted) {
                const bg = document.getElementById('bgMusic');
                bg.volume = 0.2;
                bg.play();
                audioStarted = true;
            }
        }

        function toggleMute() {
            isMuted = !isMuted;
            const bg = document.getElementById('bgMusic');
            isMuted ? bg.pause() : bg.play();
            document.getElementById('muteBtn').innerText = isMuted ? "ðŸ”‡" : "ðŸ”Š";
        }

        init();
        startGlobalTimer();
    </script>
</body>
</html>
