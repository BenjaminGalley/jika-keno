<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fruit Mania | Simba Bet</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { background: #111; color: white; text-align: center; }
        .slot-machine { background: #222; padding: 20px; border: 2px solid gold; border-radius: 15px; margin: 20px auto; max-width: 400px; }
        .reels { display: flex; justify-content: space-around; margin: 20px 0; background: black; padding: 10px; border-radius: 10px; }
        .reel { font-size: 50px; }
        .spin-btn { background: gold; border: none; padding: 15px 40px; font-size: 20px; font-weight: bold; border-radius: 50px; cursor: pointer; width: 100%; }
        .spin-btn:disabled { background: #555; }
    </style>
</head>
<body>
    <div style="padding: 10px; display:flex; justify-content:space-between; align-items:center;">
        <button onclick="location.href='index.html'" style="background:none; border:none; color:gold; font-size:24px;">‚Üê</button>
        <div style="color:gold; font-weight:bold;">BAL: <span id="gameBalance">0.00</span> ETB</div>
    </div>

    <div class="slot-machine">
        <h2 style="color:gold; margin:0;">FRUIT MANIA</h2>
        <div class="reels">
            <div class="reel" id="r1">üçí</div>
            <div class="reel" id="r2">üçí</div>
            <div class="reel" id="r3">üçí</div>
        </div>
        
        <div style="margin: 15px 0;">
            <label>BET:</label>
            <select id="betAmount" style="padding: 5px; background: #333; color: white; border: 1px solid gold;">
                <option value="10">10 ETB</option>
                <option value="20">20 ETB</option>
                <option value="50">50 ETB</option>
            </select>
        </div>

        <div id="status" style="height:25px; color:#2ecc71; font-weight:bold;"></div>
        <button class="spin-btn" id="spinBtn" onclick="spin()">SPIN</button>
    </div>

    <script>
        const symbols = ['üçí', 'üçã', 'üçâ', '‚≠ê', 'üíé', '7Ô∏è‚É£'];
        
        function updateUI() {
            const user = JSON.parse(localStorage.getItem('simba_active_user'));
            if(user) document.getElementById('gameBalance').innerText = parseFloat(user.balance).toFixed(2);
            else location.href = 'index.html';
        }

        function spin() {
            let user = JSON.parse(localStorage.getItem('simba_active_user'));
            const bet = parseInt(document.getElementById('betAmount').value);
            
            if(user.balance < bet) return alert("Insufficient Balance");
            
            // 1. Deduct Money
            user.balance -= bet;
            saveUser(user);
            updateUI();

            // 2. Animate
            const btn = document.getElementById('spinBtn');
            btn.disabled = true;
            document.getElementById('status').innerText = "";
            
            let spins = 0;
            const interval = setInterval(() => {
                document.getElementById('r1').innerText = symbols[Math.floor(Math.random() * symbols.length)];
                document.getElementById('r2').innerText = symbols[Math.floor(Math.random() * symbols.length)];
                document.getElementById('r3').innerText = symbols[Math.floor(Math.random() * symbols.length)];
                spins++;
                if(spins > 10) {
                    clearInterval(interval);
                    checkWin(user, bet);
                    btn.disabled = false;
                }
            }, 100);
        }

        function checkWin(user, bet) {
            const r1 = document.getElementById('r1').innerText;
            const r2 = document.getElementById('r2').innerText;
            const r3 = document.getElementById('r3').innerText;

            if(r1 === r2 && r2 === r3) {
                const win = bet * 10;
                user.balance += win;
                saveUser(user);
                updateUI();
                document.getElementById('status').innerText = `WIN! +${win} ETB`;
            } else if(r1 === r2 || r2 === r3 || r1 === r3) {
                 const win = bet * 2;
                 user.balance += win;
                 saveUser(user);
                 updateUI();
                 document.getElementById('status').innerText = `SMALL WIN! +${win} ETB`;
            }
        }

        function saveUser(user) {
            localStorage.setItem('simba_active_user', JSON.stringify(user));
            localStorage.setItem('user_' + user.phone, JSON.stringify(user));
        }

        window.onload = updateUI;
    </script>
</body>
</html>
